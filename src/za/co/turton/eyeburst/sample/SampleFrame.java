/*
 * SampleFrame.java
 *
 * Created on August 1, 2006, 12:58 PM
 */

package za.co.turton.eyeburst.sample;

import java.awt.Component;
import java.awt.GridLayout;
import java.util.Arrays;
import javax.swing.JOptionPane;
import javax.swing.JProgressBar;
import za.co.turton.eyeburst.*;

/**
 *
 * @author  james
 */
public class SampleFrame extends javax.swing.JFrame {    
        
    private TowerPublisher towerPublisher;
    
    private TowerSampleDataSet tsds;
    
    private ChartCanvas chartCanvas;
    
    private int sampleSize;
    
    /**
     * Creates new form SampleFrame
     */
    public SampleFrame(TowerPublisher towerPublisher, int sampleSize) {
        
        if (sampleSize <= 0)
            throw new IllegalArgumentException("Sample size must be >= 1");
        
        initComponents();
//        this.groups = new HashMap<String, SampleGroup>();
        this.sampleSize = sampleSize;
        this.towerPublisher = towerPublisher;
//        this.progressBars = new HashMap<Tower, JProgressBar>();
//        towerPublisher.addListener(this);
        chartCanvas = new ChartCanvas(sampleSize);
        chartCanvas.setSize(250, 500);
        chartPanel.add(chartCanvas);
    }    
        
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        sampleGroupMenu = new javax.swing.JPopupMenu();
        createGroupItem = new javax.swing.JMenuItem();
        jSplitPane1 = new javax.swing.JSplitPane();
        chartPanel = new javax.swing.JPanel();
        pendingsPanel = new javax.swing.JPanel();

        sampleGroupMenu.setInvoker(pendingsPanel);
        sampleGroupMenu.setName("createGroupPopup");
        createGroupItem.setText("Create Sample Group");
        createGroupItem.setName("createSampleGroupItem");
        createGroupItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                createGroupItemActionPerformed(evt);
            }
        });

        sampleGroupMenu.add(createGroupItem);

        getContentPane().setLayout(new javax.swing.BoxLayout(getContentPane(), javax.swing.BoxLayout.Y_AXIS));

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("eyeBurst");
        jSplitPane1.setDividerLocation(250);
        jSplitPane1.setOrientation(javax.swing.JSplitPane.VERTICAL_SPLIT);
        chartPanel.setLayout(new java.awt.GridLayout(1, 0));

        chartPanel.addComponentListener(new java.awt.event.ComponentAdapter() {
            public void componentResized(java.awt.event.ComponentEvent evt) {
                chartPanelComponentResized(evt);
            }
        });

        jSplitPane1.setLeftComponent(chartPanel);

        pendingsPanel.setLayout(new javax.swing.BoxLayout(pendingsPanel, javax.swing.BoxLayout.Y_AXIS));

        pendingsPanel.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEmptyBorder(1, 1, 1, 1), "Pending Samples (right-click to create group)", javax.swing.border.TitledBorder.CENTER, javax.swing.border.TitledBorder.DEFAULT_POSITION));
        pendingsPanel.setComponentPopupMenu(sampleGroupMenu);
        pendingsPanel.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                pendingsPanelMouseClicked(evt);
            }
        });

        jSplitPane1.setRightComponent(pendingsPanel);

        getContentPane().add(jSplitPane1);

        pack();
    }// </editor-fold>//GEN-END:initComponents
    
    private void createGroupItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_createGroupItemActionPerformed
        String groupName = JOptionPane.showInputDialog(this, "Sample Group Name");
        
        for (Component child : pendingsPanel.getComponents())
            if (child.getName() != null && child.equals(groupName))
                return;
        
        SampleGroup sampleGroup = new SampleGroup(groupName, sampleSize);
        sampleGroup.addListener(chartCanvas);
        
        SampleGroupPanel groupPanel = new SampleGroupPanel(sampleGroup);
        pendingsPanel.add(groupPanel);
        groupPanel.setVisible(true);
        pack();
    }//GEN-LAST:event_createGroupItemActionPerformed
    
    private void pendingsPanelMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_pendingsPanelMouseClicked
        // Dummy method necessary for popup menu
    }//GEN-LAST:event_pendingsPanelMouseClicked
    
    private void chartPanelComponentResized(java.awt.event.ComponentEvent evt) {//GEN-FIRST:event_chartPanelComponentResized
        if (chartCanvas != null) {
            chartCanvas.setSize(chartPanel.getSize());
            chartCanvas.repaint();
        }
    }//GEN-LAST:event_chartPanelComponentResized
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel chartPanel;
    private javax.swing.JMenuItem createGroupItem;
    private javax.swing.JSplitPane jSplitPane1;
    private javax.swing.JPanel pendingsPanel;
    private javax.swing.JPopupMenu sampleGroupMenu;
    // End of variables declaration//GEN-END:variables
    
}
